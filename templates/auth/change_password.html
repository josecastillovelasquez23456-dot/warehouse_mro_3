{% extends "base.html" %}
{% block content %}

<style>
    .password-card {
        border-radius: 12px;
        padding: 30px;
    }

    .password-card input {
        height: 48px;
        border-radius: 8px;
    }

    #strength-bar {
        height: 8px;
        border-radius: 5px;
        transition: 0.4s;
    }

    .gerdau-blue { background: #003b71; color: white; }
</style>

<div class="container mt-4">
    <div class="row justify-content-center">

        <div class="col-md-6">

            <div class="card shadow-lg password-card">

                <h3 class="text-center fw-bold gerdau-blue p-2 rounded mb-4">
                    <i class="bi bi-shield-lock-fill me-2"></i>
                    Cambiar Contraseña
                </h3>

                <form method="POST" id="passForm">

                    <!-- CONTRASEÑA ACTUAL -->
                    <label class="fw-semibold">Contraseña Actual</label>
                    <div class="input-group mb-3">
                        <span class="input-group-text" onclick="toggle('current_password')">
                            <i class="bi bi-eye"></i>
                        </span>
                        <input type="password" name="current_password" id="current_password" class="form-control" required>
                    </div>

                    <!-- NUEVA CONTRASEÑA -->
                    <label class="fw-semibold">Nueva Contraseña</label>
                    <div class="input-group mb-1">
                        <span class="input-group-text" onclick="toggle('new_password')">
                            <i class="bi bi-eye"></i>
                        </span>
                        <input type="password" name="new_password" id="new_password" class="form-control" required onkeyup="checkStrength()">
                    </div>

                    <div class="mt-1 mb-3">
                        <div id="strength-bar"></div>
                        <small id="strength-msg" class="fw-bold"></small>
                    </div>

                    <!-- CONFIRMAR CONTRASEÑA -->
                    <label class="fw-semibold">Confirmar Nueva Contraseña</label>
                    <div class="input-group mb-4">
                        <span class="input-group-text" onclick="toggle('confirm_password')">
                            <i class="bi bi-eye"></i>
                        </span>
                        <input type="password" name="confirm_password" id="confirm_password" class="form-control" required>
                    </div>

                    <button class="btn btn-primary w-100 py-2 fw-bold" type="submit">
                        <i class="bi bi-save me-1"></i>Guardar Contraseña
                    </button>

                </form>

                <a href="{{ url_for('auth.perfil_usuario') }}"
                   class="btn btn-outline-secondary w-100 mt-3">
                    <i class="bi bi-arrow-left me-1"></i>Volver al Perfil
                </a>

            </div>

        </div>

    </div>
</div>


<script>
/* Mostrar/ocultar contraseña */
function toggle(id) {
    let field = document.getElementById(id);
    field.type = field.type === "password" ? "text" : "password";
}

/* Indicador de fuerza */
function checkStrength() {
    let strengthBar = document.getElementById("strength-bar");
    let strengthMsg = document.getElementById("strength-msg");
    let pass = document.getElementById("new_password").value;

    let strength = 0;

    if (pass.match(/[a-z]/)) strength++;
    if (pass.match(/[A-Z]/)) strength++;
    if (pass.match(/[0-9]/)) strength++;
    if (pass.match(/[^A-Za-z0-9]/)) strength++;
    if (pass.length >= 8) strength++;

    switch (strength) {
        case 0:
        case 1:
            strengthBar.style.background = "red";
            strengthMsg.innerHTML = "Muy débil";
            break;
        case 2:
            strengthBar.style.background = "orange";
            strengthMsg.innerHTML = "Débil";
            break;
        case 3:
            strengthBar.style.background = "#f8c000";
            strengthMsg.innerHTML = "Regular";
            break;
        case 4:
            strengthBar.style.background = "blue";
            strengthMsg.innerHTML = "Fuerte";
            break;
        case 5:
            strengthBar.style.background = "green";
            strengthMsg.innerHTML = "Muy fuerte";
            break;
    }
}
</script>

{% endblock %}
