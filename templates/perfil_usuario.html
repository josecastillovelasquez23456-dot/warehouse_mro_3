{% extends "base.html" %}
{% block content %}

<style>
    :root {
        --gerdau-blue: #003b71;
        --gerdau-dark: #001d38;
        --gerdau-yellow: #f8c000;
        --gerdau-grey: #f2f2f2;
    }

    .profile-page {
        animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to   { opacity: 1; transform: translateY(0); }
    }

    /* ==================== HEADER ==================== */
    .profile-header {
        background: linear-gradient(135deg, var(--gerdau-dark), var(--gerdau-blue));
        padding: 35px;
        border-radius: 15px;
        color: white;
        text-align: center;
        position: relative;
    }

    .profile-header img {
        width: 160px;
        height: 160px;
        max-width: 45vw;
        max-height: 45vw;
        border-radius: 50%;
        border: 5px solid var(--gerdau-yellow);
        object-fit: cover;
        box-shadow: 0px 4px 15px rgba(0,0,0,0.3);
    }

    /* Estado */
    .status-badge {
        position: absolute;
        right: 20px;
        top: 20px;
        background: var(--gerdau-yellow);
        color: black;
        padding: 6px 12px;
        border-radius: 30px;
        font-weight: bold;
        font-size: 0.85rem;
    }

    @media (max-width: 576px) {
        .status-badge {
            right: 10px;
            top: 10px;
            font-size: 0.75rem;
            padding: 5px 10px;
        }
    }

    /* ==================== KPI BOX ==================== */
    .kpi-box {
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0px 3px 8px rgba(0,0,0,0.1);
        transition: 0.3s;
        height: 100%;
    }

    .kpi-box:hover {
        transform: translateY(-5px);
    }

    /* ==================== INFO SECTIONS ==================== */
    .section-title {
        font-weight: bold;
        border-left: 5px solid var(--gerdau-blue);
        padding-left: 10px;
    }

    .info-box {
        padding: 15px;
        border-radius: 10px;
        background: white;
        box-shadow: 0px 2px 6px rgba(0,0,0,0.1);
        margin-bottom: 12px;
    }

    /* Timeline */
    .timeline {
        border-left: 3px solid var(--gerdau-blue);
        padding-left: 15px;
        margin-top: 10px;
    }

    .timeline-item {
        margin-bottom: 12px;
        font-size: 0.95rem;
    }

    /* ==================== BOTONES ==================== */
    .btn-gerdau {
        background: var(--gerdau-blue);
        color: white;
        border-radius: 10px;
        font-weight: bold;
    }

    .btn-gerdau:hover {
        background: #00284f;
    }

    @media (max-width: 576px) {
        .btn-gerdau, .btn, .btn-warning, .btn-secondary, .btn-dark {
            width: 100%;
            margin-bottom: 8px;
        }
    }

</style>

<div class="container profile-page mt-4">

    <!-- ==================== HEADER ==================== -->
    <div class="profile-header mb-4">

        <!-- Estado -->
        <span class="status-badge">
            <i class="bi bi-check-circle-fill"></i> Activo
        </span>

        <!-- Foto -->
        <img src="{{ current_user.photo or url_for('static', filename='img/default_avatar.png') }}">

        <h2 class="mt-3 fw-bold">{{ current_user.username }}</h2>

        <p class="fs-5">
            <i class="bi bi-person-badge-fill me-1"></i>
            {{ current_user.role | upper }}
        </p>

        <p>
            <i class="bi bi-calendar2-week me-2"></i>
            Miembro desde:
            <strong>
                {% if current_user.created_at %}
                    {{ current_user.created_at.strftime('%d/%m/%Y') }}
                {% else %}
                    Sin registro
                {% endif %}
            </strong>
        </p>

        <!-- Subir Foto -->
        <a href="{{ url_for('auth.subir_foto') }}" class="btn btn-warning fw-bold mt-2">
            <i class="bi bi-camera-fill me-1"></i> Cambiar foto
        </a>
    </div>

    <!-- ==================== KPI RESPONSIVO ==================== -->
    <div class="row text-center g-3">

        <div class="col-6 col-md-3">
            <div class="kpi-box">
                <i class="bi bi-box-seam-fill fs-1 text-primary"></i>
                <h3>{{ kpi_inventarios }}</h3>
                <p>Inventarios Subidos</p>
            </div>
        </div>

        <div class="col-6 col-md-3">
            <div class="kpi-box">
                <i class="bi bi-truck fs-1 text-success"></i>
                <h3>{{ kpi_bultos }}</h3>
                <p>Bultos Registrados</p>
            </div>
        </div>

        <div class="col-6 col-md-3">
            <div class="kpi-box">
                <i class="bi bi-bell-fill fs-1 text-danger"></i>
                <h3>{{ kpi_alertas }}</h3>
                <p>Alertas Reportadas</p>
            </div>
        </div>

        <div class="col-6 col-md-3">
            <div class="kpi-box">
                <i class="bi bi-graph-up-arrow fs-1 text-info"></i>
                <h3>{{ perfil_completado }}%</h3>
                <p>Perfil Completado</p>
            </div>
        </div>

    </div>

    <!-- ==================== INFORMACIÓN PERSONAL ==================== -->
    <div class="card shadow-lg p-4 mt-4">

        <h4 class="section-title">
            <i class="bi bi-person-lines-fill me-2"></i> Información Personal
        </h4>
        <hr>

        <div class="info-box">
            <strong><i class="bi bi-envelope-at me-2 text-primary"></i>Correo:</strong>
            {{ current_user.email or "No registrado" }}
        </div>

        <div class="info-box">
            <strong><i class="bi bi-phone-fill me-2 text-primary"></i>Teléfono:</strong>
            {{ current_user.phone or "No registrado" }}
        </div>

        <div class="info-box">
            <strong><i class="bi bi-geo-alt-fill me-2 text-primary"></i>Ubicación:</strong>
            {{ current_user.location or "Sin especificar" }}
        </div>

        <div class="info-box">
            <strong><i class="bi bi-building-fill me-2 text-primary"></i>Área:</strong>
            {{ current_user.area or "No asignada" }}
        </div>

        <!-- ==================== ACTIVIDAD ==================== -->
        <h4 class="section-title mt-4">
            <i class="bi bi-clock-history me-2"></i> Actividad Reciente
        </h4>
        <hr>

        <div class="timeline">
            {% for log in actividad %}
            <div class="timeline-item">
                <strong>{{ log.fecha }}</strong> — {{ log.descripcion }}
            </div>
            {% else %}
            <p class="text-muted">No hay actividad registrada.</p>
            {% endfor %}
        </div>

        <!-- ==================== BOTONES ==================== -->
        <div class="text-center mt-4">

            <div class="row g-2">
                <div class="col-12 col-md-3">
                    <a href="{{ url_for('auth.edit_user') }}" class="btn btn-gerdau w-100">
                        <i class="bi bi-pencil-square me-1"></i> Editar Perfil
                    </a>
                </div>

                <div class="col-12 col-md-3">
                    <a href="{{ url_for('auth.cambiar_password') }}" class="btn btn-warning w-100">
                        <i class="bi bi-key-fill me-1"></i> Cambiar Contraseña
                    </a>
                </div>

                <div class="col-12 col-md-3">
                    <a href="{{ url_for('auth.descargar_datos_gerencia') }}" class="btn btn-secondary w-100">
                        <i class="bi bi-file-earmark-pdf me-1"></i> Reporte PDF
                    </a>
                </div>

                <div class="col-12 col-md-3">
                    <a href="{{ url_for('dashboard.dashboard') }}" class="btn btn-dark w-100">
                        <i class="bi bi-arrow-left me-1"></i> Volver
                    </a>
                </div>
            </div>

        </div>

    </div>

</div>

{% endblock %}

