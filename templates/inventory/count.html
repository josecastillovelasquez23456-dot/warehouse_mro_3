{% extends "base.html" %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
    <div>
        <h4 class="fw-bold mb-1"> Conteo de Inventario en L铆nea</h4>
        <p class="text-muted mb-0">
            Registre el <strong>stock contado</strong> compar谩ndolo con la columna
            <strong>Libre utilizaci贸n</strong> del sistema.
        </p>
    </div>

    <a href="{{ url_for('inventory.list_inventory') }}" class="btn btn-outline-secondary btn-sm">
        <i class="bi bi-arrow-left me-1"></i>Volver a inventario
    </a>
</div>

<form method="post">

    <div class="card shadow-lg border-0">
        <div class="card-header bg-primary text-white">
            <strong>Ingreso de datos para conteo f铆sico</strong>
        </div>

        <div class="card-body table-responsive p-0" style="max-height:70vh; overflow-y:auto;">
            <table class="table table-sm table-hover align-middle mb-0">

                <thead class="table-dark">
                    <tr>
                        <th>C贸digo</th>
                        <th>Descripci贸n</th>
                        <th>Unidad</th>
                        <th>Ubicaci贸n</th>
                        <th class="text-end">Stock Sistema</th>
                        <th class="text-end">Stock Contado</th>
                    </tr>
                </thead>

                <tbody>
                    {% for item in items %}
                        {% set st = item.status %}
                        {% if st == 'critico' %}
                            {% set row_class = 'table-danger' %}
                        {% elif st == 'bajo' %}
                            {% set row_class = 'table-warning' %}
                        {% elif st == 'normal' %}
                            {% set row_class = '' %}
                        {% else %}
                            {% set row_class = 'table-secondary' %}
                        {% endif %}

                        <tr class="{{ row_class }}">
                            <td class="fw-bold">{{ item.material_code }}</td>
                            <td>{{ item.material_text }}</td>
                            <td>{{ item.base_unit }}</td>
                            <td><span class="badge bg-dark">{{ item.location }}</span></td>
                            <td class="text-end fw-bold">{{ "%.2f"|format(item.libre_utilizacion) }}</td>

                            <td style="max-width:110px;">
                                <input type="number"
                                       step="0.01"
                                       min="0"
                                       name="count_{{ item.id }}"
                                       class="form-control form-control-sm text-end shadow-sm"
                                       placeholder="0.00">
                            </td>
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="6" class="text-center text-muted py-4">
                                No hay inventario cargado.
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>

            </table>
        </div>

        <div class="card-footer d-flex justify-content-end bg-light">
            <button type="submit" class="btn btn-success px-4 shadow-sm">
                <i class="bi bi-file-earmark-spreadsheet me-1"></i>
                Generar discrepancias (Excel)
            </button>
        </div>

    </div>
</form>

{% endblock %}
